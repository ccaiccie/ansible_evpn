---
# tasks file for excel_nxos 
#  - name: Decrypt the password file
#    include_vars: ./playbooks/passwords.yml

  - name: Import host-specific facts from a CSV file
    csv_to_facts:
      src: "./roles/{{role}}/files/leaf_vars.csv" 

#  - name: Optionally display the facts
#    debug: var=spreadsheet

  - name: Generate host-specific variables for each leaf
    template:
      src: host_vars.j2 
      dest: "./roles/{{role}}/vars/{{inventory_hostname}}.yml" 

# Including the host specific variables from the generated file
  - include_vars: "{{inventory_hostname}}.yml"
      

  - name: Import facts from a CSV file for uplink ports
    csv_to_facts:
      src: "./roles/{{role}}/files/{{inventory_hostname}}_uplinks.csv"

# Including the group_vars,  because they were being ignored (receiving Undefined Variable error)

  - include_vars: "~/ansible/playbooks/group_vars/leaf"

  - name: Render switch uplink ports
    template:
      src: leaf_uplinks.j2
      dest: "{{configuration_file[0].type}}"

  - name: Render switch global configuration commands 
    template:
      src: leaf_global.j2
      dest: "{{configuration_file[1].type}}"
#
#  - name: Configure the Nexus through the NX-API
#    nxapi_install_config:
#      config_file: "{{item.type}}" 
#      host: "{{inventory_hostname}}"
#      username: "{{username}}"
#      password: "{{password}}"
#      debug: "{{debug}}"
#    with_items: "{{configuration_file}}"  
